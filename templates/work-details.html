<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>WorkWise - Детали работы</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}" />
  </head>
  <body>
    <div id="workDetailsPage">
      <nav class="top-nav">
        <div class="nav-left">
          <button class="back-btn" id="backToLK">← Назад</button>
          <span class="logo">WorkWise</span>
        </div>
        <div class="nav-links"></div>
      </nav>

      <main class="main-content">
        <div class="work-details-container">
          <div class="work-content">
            <h2 class="work-title">Программирование. Лабораторная работа №7</h2>
            <p class="work-deadline">Дедлайн: 18 октября 22:00</p>

            <div class="work-file-name">Laba_7_Ivanovl.docx</div>

            <div class="work-text">
              <h3>Задание:</h3>
              <p>
                Разработать программу на языке Python для обработки данных о
                студентах. Программа должна:
              </p>
              <ul>
                <li>Считывать данные из CSV-файла</li>
                <li>Выполнять фильтрацию по заданным критериям</li>
                <li>Формировать отчет в виде таблицы</li>
                <li>Сохранять результаты в новый файл</li>
              </ul>

              <h3>Требования:</h3>
              <p>
                Программа должна быть реализована с использованием
                объектно-ориентированного подхода. Код должен быть хорошо
                документирован и содержать обработку исключительных ситуаций.
              </p>

              <h3>Реализация:</h3>
              <p>
                В данной работе представлена программа, состоящая из трех
                классов: Student, StudentManager и ReportGenerator. Класс
                Student описывает сущность студента, StudentManager отвечает за
                загрузку и фильтрацию данных, а ReportGenerator формирует
                итоговый отчет.
              </p>

              <p>Основной алгоритм работы программы:</p>
              <ol>
                <li>Загрузка данных из CSV-файла</li>
                <li>Парсинг данных и создание объектов Student</li>
                <li>Фильтрация по среднему баллу (>= 4.0)</li>
                <li>Сортировка по фамилии</li>
                <li>Генерация отчета в формате таблицы</li>
                <li>Сохранение результатов в файл "report.txt"</li>
              </ol>

              <p>
                Код программы содержит комментарии, поясняющие ключевые моменты
                реализации. Обработка исключений реализована для случаев
                отсутствия файла или некорректного формата данных.
              </p>
            </div>
          </div>

          <div class="work-sidebar">
            <div class="status-section" style="background-color: #414a48; border-radius: 20px; padding: 25px; margin-bottom: 25px;">
              <h3 class="section-title" style="color: #b6d4cf; font-size: 20px; margin-bottom: 20px; border-bottom: 2px solid #339989; padding-bottom: 10px;">Статус проверки</h3>
              
              <div class="status-info" style="margin-bottom: 20px;">
                  <div class="status-label" style="font-weight: 500; margin-bottom: 8px; color: #b6d4cf;">Статус:</div>
                  <div class="status-value {% if result and result.success %}status-approved{% else %}status-rejected{% endif %}" style="padding: 10px 15px; border-radius: 10px; display: inline-block; font-weight: 500; {% if result and result.success %}background-color: rgba(76, 175, 80, 0.2); color: #4caf50;{% else %}background-color: rgba(244, 67, 54, 0.2); color: #f44336;{% endif %}">
                      {% if result and result.success %}Успешно обработано{% elif result and not result.success %}Ошибка обработки{% else %}В обработке{% endif %}
                  </div>
              </div>
          
              <div class="file-info" style="color: #b6d4cf;">
                  <p><strong>Обработано ссылок:</strong> 
                      {% if result and result.success %}
                          {{ result.processed_count }}
                      {% else %}
                          0
                      {% endif %}
                  </p>
                  <p><strong>Тип обработки:</strong> {{ gost.name if gost else 'Не указан' }}</p>
                  <p><strong>Дата обработки:</strong> {{ upload.upload_date.strftime('%d.%m.%Y') }}</p>
                  {% if result and result.statistics %}
                  <p><strong>Найдено ссылок:</strong> {{ result.statistics.total_found }}</p>
                  {% endif %}
              </div>
          </div>
              <h3 class="section-title">Статус проверки</h3>

              <div class="status-info">
                <div class="status-label">Статус:</div>
                <div class="status-value status-rejected">Отклонено ИИ</div>
              </div>

              <div class="comments-section">
                <div class="status-label">Комментарии от ИИ:</div>

                <div class="ai-comment">
                  <div class="comment-header">
                    <span>ИИ-ассистент</span>
                    <span>15.10.2025 14:30</span>
                  </div>
                  <p><strong>Основные замечания:</strong></p>
                  <ul>
                    <li>Отсутствует обработка случая, когда CSV-файл пуст</li>
                    <li>Нет валидации данных при создании объектов Student</li>
                    <li>
                      В методе generate_report не учитывается возможная ошибка
                      при записи файла
                    </li>
                  </ul>
                </div>

                <div class="ai-comment">
                  <div class="comment-header">
                    <span>ИИ-ассистент</span>
                    <span>15.10.2025 14:32</span>
                  </div>
                  <p><strong>Рекомендации по улучшению:</strong></p>
                  <ol>
                    <li>
                      Добавить проверку на пустой файл в методе load_from_csv
                    </li>
                    <li>Реализовать метод validate_data в классе Student</li>
                    <li>Добавить блок try-except при записи отчета в файл</li>
                    <li>Увеличить покрытие кода unit-тестами</li>
                  </ol>
                </div>

                <div class="ai-comment">
                  <div class="comment-header">
                    <span>ИИ-ассистент</span>
                    <span>15.10.2025 14:35</span>
                  </div>
                  <p><strong>Оценка качества кода:</strong> 67%</p>
                  <p>
                    Код соответствует базовым требованиям, но требует доработки
                    в части обработки крайних случаев и улучшения надежности.
                  </p>
                </div>
              </div>
            </div>

            <div class="previous-files-section">
              <h3 class="section-title">Загружено ранее:</h3>
              <p class="work-text">
                Файлы этой лабораторной работы, отклоненные ИИ
              </p>

              <ul class="file-list">
                <li class="file-item">
                  <input type="checkbox" class="file-checkbox" />
                  <a href="#" class="file-name">Laba_7_v1_Ivanov.docx</a>
                  <span class="file-status status-rejected-badge"
                    >Отклонено</span
                  >
                </li>
                <li class="file-item">
                  <input type="checkbox" class="file-checkbox" />
                  <a href="#" class="file-name">Laba_7_v2_Ivanov_fixed.py</a>
                  <span class="file-status status-rejected-badge"
                    >Отклонено</span
                  >
                </li>
                <li class="file-item">
                  <input type="checkbox" class="file-checkbox" />
                  <a href="#" class="file-name"
                    >Laba_7_v3_Ivanov_complete.zip</a
                  >
                  <span class="file-status status-rejected-badge"
                    >Отклонено</span
                  >
                </li>
                <li class="file-item">
                  <input type="checkbox" class="file-checkbox" />
                  <a href="#" class="file-name"
                    >Laba_7_v4_Ivanov_final_version.docx</a
                  >
                  <span class="file-status status-rejected-badge"
                    >Отклонено</span
                  >
                </li>
              </ul>
            </div>
          </div>
        </div>
      </main>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        document
          .getElementById("backToLK")
          .addEventListener("click", function () {
            // ИСПРАВЛЕНО: Используем return_route, переданный из Flask, чтобы получить абсолютный путь.
            window.location.href = "{{ return_route }}";
          });
      });
    </script>
  </body>
</html>
